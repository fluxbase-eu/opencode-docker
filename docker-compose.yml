services:
  opencode:
    image: ghcr.io/fluxbase-eu/opencode-docker:latest
    container_name: opencode
    ports:
      - "${OPENCODE_PORT:-4000}:4000"
    environment:
      # Optional server password for authentication
      # - OPENCODE_SERVER_PASSWORD=${OPENCODE_SERVER_PASSWORD:-}
      {}
    volumes:
      # Persistent configuration (UI config saved here)
      - opencode-config:/home/opencode/.config/opencode

      # Session storage, cache, and auth credentials
      - opencode-data:/home/opencode/.local/share/opencode

      # Working directory for projects
      - opencode-workspace:/home/opencode/workspace
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  opencode-config:
    driver: local
  opencode-data:
    driver: local
  opencode-workspace:
    driver: local
