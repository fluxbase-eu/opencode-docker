# Default values for opencode Helm chart

image:
  repository: ghcr.io/fluxbase-eu/opencode-docker
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Global labels applied to all resources
globalLabels: {}
# Example:
# globalLabels:
#   environment: production
#   team: platform

# Global annotations applied to all resources
globalAnnotations: {}
# Example:
# globalAnnotations:
#   prometheus.io/scrape: "true"

serviceAccount:
  create: true
  annotations: {}
  labels: {}
  name: {}

# Deployment labels and annotations (in addition to global labels/annotations)
deployment:
  labels: {}
  annotations: {}

# Pod labels and annotations (in addition to global labels/annotations)
pod:
  labels: {}
  annotations: {}

podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true
  runAsUser: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

service:
  type: ClusterIP
  port: 4000
  # Service labels and annotations (in addition to global labels/annotations)
  labels: {}
  annotations: {}
  # Additional service selectors
  selectors: {}

# Ingress configuration (Legacy Ingress API)
ingress:
  enabled: false
  className: ""
  # Ingress labels and annotations (in addition to global labels/annotations)
  labels: {}
  annotations: {}
  # Default backend for the ingress (optional)
  # backend:
  #   service:
  #     name: ""
  #     port:
  #       number: 4000
  hosts:
    - host: opencode.example.com
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: opencode
              port:
                number: 4000
  tls: []
  #  - secretName: opencode-tls
  #    hosts:
  #      - opencode.example.com

# Gateway API configuration (Kubernetes Gateway API v1beta1)
gatewayAPI:
  enabled: false

  # Gateway reference (optional - if not specified, uses the default gateway)
  gatewaySelector:
    # Gateway labels to attach to
    matchLabels:
      # gateway: external-gateway

  # HTTPRoute configuration
  httpRoute:
    enabled: true
    # HTTPRoute labels and annotations (in addition to global labels/annotations)
    labels: {}
    annotations: {}

    # Hostnames for the route
    hostnames:
      - opencode.example.com

    # Route rules
    rules:
      - backendRefs:
          - name: opencode
            kind: Service
            port: 4000
        matches:
          - path:
              type: Prefix
              value: /

    # TLS configuration
    tls: []
    #  - hostname: opencode.example.com
    #   mode: Terminate
    #   certificateRef:
    #     name: opencode-cert
    #     kind: Secret

    # Request headers (optional)
    # requestHeaders:
    #   add:
    #     - name: X-Custom-Header
    #       value: "custom-value"
    #   remove: ["X-Remove-Header"]
    #   set:
    #     - name: X-Override-Header
    #       value: "override-value"

# Extra environment variables (optional)
# You can add custom environment variables here if needed
extraEnv: []
# - name: CUSTOM_VAR
#   value: "custom-value"
# - name: FROM_SECRET
#   valueFrom:
#     secretKeyRef:
#       name: my-secret
#       key: my-key
# Example:
# extraEnv:
#   - name: CUSTOM_VAR
#     value: "custom-value"
#   - name: FROM_SECRET
#     valueFrom:
#       secretKeyRef:
#         name: my-secret
#         key: my-key

# Extra volumes to add to the pod
extraVolumes: []
# Example:
# extraVolumes:
#   - name: custom-config
#     configMap:
#       name: my-custom-config
#   - name: custom-secret
#     secret:
#       secretName: my-custom-secret
#   - name: pvc-volume
#     persistentVolumeClaim:
#       claimName: my-pvc

# Extra volume mounts to add to the container
extraVolumeMounts: []
# Example:
# extraVolumeMounts:
#   - name: custom-config
#     mountPath: /etc/custom-config
#     readOnly: true
#   - name: custom-secret
#     mountPath: /etc/custom-secret
#     readOnly: true
#   - name: pvc-volume
#     mountPath: /data/custom

# Extra containers to add to the pod (sidecars)
extraContainers: []
# Example:
# extraContainers:
#   - name: sidecar
#     image: busybox
#     command: ["/bin/sh"]
#     args: ["-c", "while true; do echo hello; sleep 10;done"]
#     volumeMounts:
#       - name: workspace
#         mountPath: /home/opencode/workspace

persistence:
  enabled: true
  # Storage class for PVCs
  # If not set, the cluster's default storage class will be used
  storageClass: ""
  accessMode: ReadWriteOnce
  # Size for each PVC
  size: 1Gi
  # PVC labels and annotations (in addition to global labels/annotations)
  labels: {}
  annotations: {}

  # Individual PVC configurations
  config:
    enabled: true
    existingClaim: ""  # Use existing PVC (if set, will not create a new one)
    size: null  # Uses persistence.size if null
  data:
    enabled: true
    existingClaim: ""  # Use existing PVC (if set, will not create a new one)
    size: null  # Uses persistence.size if null
  workspace:
    enabled: true
    existingClaim: ""  # Use existing PVC (if set, will not create a new one)
    size: null  # Uses persistence.size if null

resources:
  limits:
    cpu: 2
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Probes configuration
probes:
  liveness:
    enabled: true
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 3

  readiness:
    enabled: true
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    successThreshold: 1
    failureThreshold: 3

  startup:
    enabled: true
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    successThreshold: 1
    failureThreshold: 30
